version: v1beta9
images:
  app:
    image: darkbones/darkbugs
    preferSyncOverRebuild: true
    injectRestartHelper: true
    appendDockerfileInstructions:
    - USER root
deployments:
  - name: database
    helm:
      chart:
        name: stable/postgresql
        version: "6.5.9"
      values:
        postgresqlDatabase: "db_app"
        postgresqlUsername: "db_user"
        postgresqlPassword: ${DB_PASSWORD}
  - name: app
    helm:
      componentChart: true
      values:
        containers:
          - image: darkbones/darkbugs
            env:
              - name: DB_PASSWORD
                value: ${DB_PASSWORD}
              - name: DB_USERNAME
                value: db_user
        service:
          ports:
            - port: 3000
dev:
  ports:
  - imageName: app
    forward:
    - port: 3000
  open:
  - url: http://localhost:3000
  sync:
  - imageName: app
    excludePaths:
    - .git/
    uploadExcludePaths:
    - config/master.key
    - config/k8s/secret*
    - devspace.yaml
    onUpload:
      restartContainer: true
profiles:
- name: production
  patches:
  - op: remove
    path: images.app.injectRestartHelper
  - op: remove
    path: images.app.appendDockerfileInstructions
